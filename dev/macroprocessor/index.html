<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Macroprocessing language · Dynare.jl</title><meta name="title" content="Macroprocessing language · Dynare.jl"/><meta property="og:title" content="Macroprocessing language · Dynare.jl"/><meta property="twitter:title" content="Macroprocessing language · Dynare.jl"/><meta name="description" content="Documentation for Dynare.jl."/><meta property="og:description" content="Documentation for Dynare.jl."/><meta property="twitter:description" content="Documentation for Dynare.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/citations.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Dynare.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation-and-configuration/">Installation and Configuration</a></li><li><a class="tocitem" href="../running-dynare/">Running Dynare</a></li><li><span class="tocitem">Model File</span><ul><li><a class="tocitem" href="../model-file/syntax-elements/">Syntax elements</a></li><li><a class="tocitem" href="../model-file/variable-declarations/">Variables and parameters declaration</a></li><li><a class="tocitem" href="../model-file/model-declaration/">Model declaration</a></li><li><a class="tocitem" href="../model-file/steady-state/">Steady state</a></li><li><a class="tocitem" href="../model-file/shocks/">Shocks on exgogenous variables</a></li><li><a class="tocitem" href="../model-file/deterministic-simulations/">Deterministic simulations</a></li><li><a class="tocitem" href="../model-file/local-approxiation/">Local approximation</a></li><li><a class="tocitem" href="../model-file/filtersmoother/">State space, filtering and smoothing</a></li><li><a class="tocitem" href="../model-file/estimation/">Estimation</a></li><li><a class="tocitem" href="../model-file/forecasting/">Forecasting</a></li><li><a class="tocitem" href="../model-file/reporting/">Reporting</a></li></ul></li><li class="is-active"><a class="tocitem" href>Macroprocessing language</a><ul class="internal"><li><a class="tocitem" href="#Macro-processing-language"><span>Macro processing language</span></a></li><li><a class="tocitem" href="#Verbatim-inclusion"><span>Verbatim inclusion</span></a></li><li><a class="tocitem" href="#Misc-commands"><span>Misc commands</span></a></li></ul></li><li><a class="tocitem" href="../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Macroprocessing language</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Macroprocessing language</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/DynareJulia/Dynare.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/DynareJulia/Dynare.jl/blob/main/docs/src/macroprocessor.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h2 id="Macro-processing-language"><a class="docs-heading-anchor" href="#Macro-processing-language">Macro processing language</a><a id="Macro-processing-language-1"></a><a class="docs-heading-anchor-permalink" href="#Macro-processing-language" title="Permalink"></a></h2><p>It is possible to use &quot;macro&quot; commands in the <code>.mod</code> file for performing tasks such as: including modular source files, replicating blocks of equations through loops, conditionally executing some code, writing indexed sums or products inside equations...</p><p>The Dynare macro-language provides a new set of <em>macro-commands</em> which can be used in <code>.mod</code> files. It features:</p><ul><li>File inclusion</li><li>Loops (<code>for</code> structure)</li><li>Conditional inclusion (<code>if/then/else</code> structures)</li><li>Expression substitution</li></ul><p>This macro-language is totally independent of the basic Dynare language, and is processed by a separate component of the Dynare pre-processor. The macro processor transforms a <code>.mod</code> file with macros into a <code>.mod</code> file without macros (doing expansions/inclusions), and then feeds it to the Dynare parser. The key point to understand is that the macro processor only does text substitution (like the C preprocessor or the PHP language). Note that it is possible to see the output of the macro processor by using the <code>savemacro</code> option of the <code>dynare</code> command (see <code>dyn-invoc</code>).</p><p>The macro processor is invoked by placing <em>macro directives</em> in the <code>.mod</code> file. Directives begin with an at-sign followed by a pound sign (<code>@#</code>). They produce no output, but give instructions to the macro processor. In most cases, directives occupy exactly one line of text. If needed, two backslashes (<code>\\</code>) at the end of the line indicate that the directive is continued on the next line. Macro directives following <code>//</code> are not interpreted by the macro processor. For historical reasons, directives in commented blocks, <em>ie</em> surrounded by <code>/*</code> and <code>*/</code>, are interpreted by the macro processor. The user should not rely on this behavior. The main directives are:</p><ul><li><code>@#includepath</code>, paths to search for files that are to be   included,</li><li><code>@#include</code>, for file inclusion,</li><li><code>@#define</code>, for defining a macro processor variable,</li><li><code>@#if, @#ifdef, @#ifndef, @#elseif, @#else, @#endif</code> for   conditional statements,</li><li><code>@#for, @#endfor</code> for constructing loops.</li></ul><p>The macro processor maintains its own list of variables (distinct from model variables and Julia variables). These macro-variables are assigned using the <code>@#define</code> directive and can be of the following basic types: boolean, real, string, tuple, function, and array (of any of the previous types).</p><h3 id="Macro-expressions"><a class="docs-heading-anchor" href="#Macro-expressions">Macro expressions</a><a id="Macro-expressions-1"></a><a class="docs-heading-anchor-permalink" href="#Macro-expressions" title="Permalink"></a></h3><p>Macro-expressions can be used in two places:</p><ul><li>Inside macro directives, directly;</li><li>In the body of the <code>.mod</code> file, between an at-sign and curly   braces: the macro processor will substitute the   expression with its value</li></ul><p>It is possible to construct macro-expressions that can be assigned to macro-variables or used within a macro-directive. The expressions are constructed using literals of the basic types (boolean, real, string, tuple, array), comprehensions, macro-variables, macro-functions, and standard operators.</p><div class="admonition is-info" id="Note-d97b98f3ca446f1f"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-d97b98f3ca446f1f" title="Permalink"></a></header><div class="admonition-body"><p>Elsewhere in the manual, MACRO_EXPRESSION designates an expression constructed as explained in this section.</p></div></div><p><strong>Boolean</strong></p><p>The following operators can be used on booleans:</p><ul><li>Comparison operators: <code>==, !=</code></li><li>Logical operators: <code>&amp;&amp;, ||, !</code></li></ul><p><strong>Real</strong></p><p>The following operators can be used on reals:</p><ul><li><p>Arithmetic operators: <code>+, -, *, /, ^</code></p></li><li><p>Comparison operators: <code>&lt;, &gt;, &lt;=, &gt;=, ==, !=</code></p></li><li><p>Logical operators: <code>&amp;&amp;, ||, !</code></p></li><li><p>Ranges with an increment of <code>1</code>: <code>REAL1:REAL2</code> (for example, <code>1:4</code>   is equivalent to real array <code>[1, 2, 3, 4]</code>).</p><p>4.6 Previously, putting brackets around the arguments to the colon   operator (e.g. <code>[1:4]</code>) had no effect. Now, <code>[1:4]</code> will create an   array containing an array (i.e. <code>[ [1, 2, 3, 4] ]</code>).</p></li><li><p>Ranges with user-defined increment: <code>REAL1:REAL2:REAL3</code> (for   example, <code>6:-2.1:-1</code> is equivalent to real array   <code>[6, 3.9, 1.8, -0.3]</code>).</p></li><li><p>Functions:   <code>max, min, mod, exp, log, log10, sin, cos, tan, asin, acos, atan, sqrt, cbrt, sign, floor, ceil, trunc, erf, erfc, gamma, lgamma, round, normpdf, normcdf</code>.   NB <code>ln</code> can be used instead of <code>log</code></p></li></ul><p><strong>String</strong></p><p>String literals have to be enclosed by <strong>double</strong> quotes (like <code>&quot;name&quot;</code>).</p><p>The following operators can be used on strings:</p><ul><li>Comparison operators: <code>&lt;, &gt;, &lt;=, &gt;=, ==, !=</code></li><li>Concatenation of two strings: <code>+</code></li><li>Extraction of substrings: if <code>s</code> is a string, then <code>s[3]</code> is a   string containing only the third character of <code>s</code>, and <code>s[4:6]</code>   contains the characters from 4th to 6th</li><li>Function: <code>length</code></li></ul><p><strong>Tuple</strong></p><p>Tuples are enclosed by parenthesis and elements separated by commas (like <code>(a,b,c)</code> or <code>(1,2,3)</code>).</p><p>The following operators can be used on tuples:</p><ul><li>Comparison operators: <code>==, !=</code></li><li>Functions: <code>empty, length</code></li></ul><p><strong>Array</strong></p><p>Arrays are enclosed by brackets, and their elements are separated by commas (like <code>[1,[2,3],4]</code> or <code>[&quot;US&quot;, &quot;FR&quot;]</code>).</p><p>The following operators can be used on arrays:</p><ul><li>Comparison operators: <code>==, !=</code></li><li>Dereferencing: if <code>v</code> is an array, then <code>v[2]</code> is its 2nd element</li><li>Concatenation of two arrays: <code>+</code></li><li>Set union of two arrays: <code>|</code></li><li>Set intersection of two arrays: <code>&amp;</code></li><li>Difference <code>-</code>: returns the first operand from which the elements   of the second operand have been removed.</li><li>Cartesian product of two arrays: <code>*</code></li><li>Cartesian product of one array N times: <code>^N</code></li><li>Extraction of sub-arrays: e.g. <code>v[4:6]</code></li><li>Testing membership of an array: <code>in</code> operator (for example: <code>&quot;b&quot;</code>   in <code>[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]</code> returns <code>1</code>)</li><li>Functions: <code>empty, sum, length</code></li></ul><p><strong>Comprehension</strong></p><p>Comprehension syntax is a shorthand way to make arrays from other arrays. There are three different ways the comprehension syntax can be employed: [filtering], [mapping], and [filtering and mapping].</p><p><strong>Filtering</strong></p><p>Filtering allows one to choose those elements from an array for which a certain condition hold.</p><p><em>Example</em></p><p>Create a new array, choosing the even numbers from the array <code>1:5</code>:</p><pre><code class="nohighlight hljs">     [ i in 1:5 when mod(i,2) == 0 ]</code></pre><p>would result in:</p><pre><code class="nohighlight hljs">   [2, 4]</code></pre><p><strong>Mapping</strong></p><p>Mapping allows you to apply a transformation to every element of an array.</p><p><em>Example</em></p><p>Create a new array, squaring all elements of the array <code>1:5</code>:</p><pre><code class="nohighlight hljs">   [ i^2 for i in 1:5 ]</code></pre><p>would result in:</p><pre><code class="nohighlight hljs">    [1, 4, 9, 16, 25]</code></pre><p><strong>Filtering and Mapping</strong></p><p>Combining the two preceding ideas would allow one to apply a transformation to every selected element of an array.</p><p><em>Example</em></p><p>Create a new array, squaring all even elements of the array <code>1:5</code>:</p><pre><code class="nohighlight hljs">   [ i^2 for i in 1:5 when mod(i,2) == 0]</code></pre><p>would result in:</p><pre><code class="nohighlight hljs">    [4, 16]</code></pre><p><em>Further Examples</em> :</p><pre><code class="nohighlight hljs">   [ (j, i+1) for (i,j) in (1:2)^2 ]
   [ (j, i+1) for (i,j) in (1:2)*(1:2) when i &lt; j ]</code></pre><p>would result in:</p><pre><code class="nohighlight hljs">     [(1, 2), (2, 2), (1, 3), (2, 3)]
     [(2, 2)]</code></pre><p><strong>Function</strong></p><p>Functions can be defined in the macro processor using the <code>@#define</code> directive (see below). A function is evaluated at the time it is invoked, not at define time. Functions can be included in expressions and the operators that can be combined with them depend on their return type.</p><p><strong>Checking variable type</strong></p><p>Given a variable name or literal, you can check the type it evaluates to using the following functions: <code>isboolean</code>, <code>isreal</code>, <code>isstring</code>, <code>istuple</code>, and <code>isarray</code>.</p><p><em>Examples</em></p><table><tr><th style="text-align: left"><strong>Code</strong></th><th style="text-align: left"><strong>Output</strong></th></tr><tr><td style="text-align: left"><code>isboolean(0)</code></td><td style="text-align: left"><code>false</code></td></tr><tr><td style="text-align: left"><code>isboolean(true)</code></td><td style="text-align: left"><code>true</code></td></tr><tr><td style="text-align: left"><code>isreal(&quot;str&quot;)</code></td><td style="text-align: left"><code>false</code></td></tr></table><p><strong>Casting between types</strong></p><p>Variables and literals of one type can be cast into another type. Some type changes are straightforward (e.g. changing a [real]{.title-ref} to a [string]{.title-ref}) whereas others have certain requirements (e.g. to cast an [array]{.title-ref} to a [real]{.title-ref} it must be a one element array containing a type that can be cast to [real]{.title-ref}).</p><p><em>Examples</em></p><table><tr><th style="text-align: left"><strong>Code</strong></th><th style="text-align: left"><strong>Output</strong></th></tr><tr><td style="text-align: left"><code>(bool) -1.1</code></td><td style="text-align: left"><code>true</code></td></tr><tr><td style="text-align: left"><code>(bool) 0</code></td><td style="text-align: left"><code>false</code></td></tr><tr><td style="text-align: left"><code>(real) &quot;2.2&quot;</code></td><td style="text-align: left"><code>2.2</code></td></tr><tr><td style="text-align: left"><code>(tuple) [3.3]</code></td><td style="text-align: left"><code>(3.3)</code></td></tr><tr><td style="text-align: left"><code>(array) 4.4</code></td><td style="text-align: left"><code>[4.4]</code></td></tr><tr><td style="text-align: left"><code>(real) [5.5]</code></td><td style="text-align: left"><code>5.5</code></td></tr><tr><td style="text-align: left"><code>(real) [6.6, 7.7]</code></td><td style="text-align: left"><code>error</code></td></tr><tr><td style="text-align: left"><code>(real) &quot;8.8 in a string&quot;</code></td><td style="text-align: left"><code>error</code></td></tr></table><p>Casts can be used in expressions:</p><p><em>Examples</em></p><table><tr><th style="text-align: left"><strong>Code</strong></th><th style="text-align: left"><strong>Output</strong></th></tr><tr><td style="text-align: left"><code>(bool) 0 &amp;&amp; true</code></td><td style="text-align: left"><code>false</code></td></tr><tr><td style="text-align: left"><code>(real) &quot;1&quot; + 2</code></td><td style="text-align: left"><code>3</code></td></tr><tr><td style="text-align: left"><code>(string) (3 + 4)</code></td><td style="text-align: left"><code>&quot;7&quot;</code></td></tr><tr><td style="text-align: left"><code>(array) 5 + (array) 6</code></td><td style="text-align: left"><code>[5, 6]</code></td></tr></table><h3 id="Macro-directives"><a class="docs-heading-anchor" href="#Macro-directives">Macro directives</a><a id="Macro-directives-1"></a><a class="docs-heading-anchor-permalink" href="#Macro-directives" title="Permalink"></a></h3><p><em>Macro Directive</em>: <code>@#includepath &quot;PATH&quot;</code></p><p><em>Macro Directive</em> <code>@#includepath MACRO_EXPRESSION</code></p><p>This directive adds the path contained in PATH to the list of those to search when looking for a <code>.mod</code> file specified by <code>@#include</code>. If provided with a MACRO_EXPRESSION argument, the argument must evaluate to a string. Note that these paths are added <em>after</em> any paths passed using <code>-I &lt;-I\&lt;\&lt;path\&gt;\&gt;&gt;</code>{.interpreted-text role=&quot;opt&quot;}.</p><p><em>Example</em></p><pre><code class="nohighlight hljs">     @#includepath &quot;/path/to/folder/containing/modfiles&quot;
     @#includepath folders_containing_mod_files</code></pre><p><em>Macro Directive</em>: <code>@#include &quot;FILENAME&quot;</code> </p><p><em>Macro Directive</em>: <code>@#include MACRO_EXPRESSION</code></p><p>This directive simply includes the content of another file in its place; it is exactly equivalent to a copy/paste of the content of the included file. If provided with a MACRO_EXPRESSION argument, the argument must evaluate to a string. Note that it is possible to nest includes (i.e. to include a file from an included file). The file will be searched for in the current directory. If it is not found, the file will be searched for in the folders provided by <code>-I &lt;-I\&lt;\&lt;path\&gt;\&gt;&gt;</code>{.interpreted-text role=&quot;opt&quot;} and <code>@#includepath</code>.</p><p><em>Example</em></p><pre><code class="nohighlight hljs">     @#include &quot;modelcomponent.mod&quot;
     @#include location_of_modfile</code></pre><p><em>Macro Directive</em>: <code>@#define MACRO_VARIABLE</code> </p><p><em>Macro Directive</em>: <code>@#define MACRO_VARIABLE = MACRO_EXPRESSION</code></p><p><em>Macro Directive</em>: <code>@#define MACRO_FUNCTION = MACRO_EXPRESSION</code></p><p>Defines a macro-variable or macro function.</p><p><em>Example</em></p><pre><code class="nohighlight hljs">     @#define var                      // Equals true
     @#define x = 5                    // Real
     @#define y = &quot;US&quot;                 // String
     @#define v = [ 1, 2, 4 ]          // Real array
     @#define w = [ &quot;US&quot;, &quot;EA&quot; ]       // String array
     @#define u = [ 1, [&quot;EA&quot;] ]        // Mixed array
     @#define z = 3 + v[2]             // Equals 5
     @#define t = (&quot;US&quot; in w)          // Equals true
     @#define f(x) = &quot; &quot; + x + y       // Function `f` with argument `x`
                                       // returns the string &#39; &#39; + x + &#39;US&#39;</code></pre><p><em>Example</em></p><pre><code class="nohighlight hljs">     @#define x = 1
     @#define y = [ &quot;B&quot;, &quot;C&quot; ]
     @#define i = 2
     @#define f(x) = x + &quot; + &quot; + y[i]
     @#define i = 1

     model;
       A = @{y[i] + f(&quot;D&quot;)};
     end;</code></pre><p>The latter is strictly equivalent to:</p><pre><code class="nohighlight hljs">     model;
       A = BD + B;
     end;</code></pre><p><em>Macro Directive</em>: <code>@#if MACRO_EXPRESSION</code></p><p><em>Macro Directive</em>: <code>@#ifdef MACRO_VARIABLE</code></p><p><em>Macro Directive</em>: <code>@#ifndef MACRO_VARIABLE</code> </p><p><em>Macro Directive</em>: <code>@#elseif MACRO_EXPRESSION</code> </p><p><em>Macro Directive</em>: <code>@#else @#endif</code></p><p>Conditional inclusion of some part of the <code>.mod</code> file. The lines between <code>@#if</code>, <code>@#ifdef</code>, or <code>@#ifndef</code> and the next <code>@#elseif</code>, <code>@#else</code> or <code>@#endif</code> is executed only if the condition evaluates to <code>true</code>. Following the <code>@#if</code> body, you can zero or more <code>@#elseif</code> branches. An <code>@#elseif</code> condition is only evaluated if the preceding <code>@#if</code> or <code>@#elseif</code> condition evaluated to <code>false</code>. The <code>@#else</code> branch is optional and is only evaluated if all <code>@#if</code> and <code>@#elseif</code> statements evaluate to false.</p><p>Note that when using <code>@#ifdef</code>, the condition will evaluate to <code>true</code> if the MACRO<em>VARIABLE has been previously defined, regardless of its value. Conversely, <code>@#ifndef</code> will evaluate to true if the MACRO</em>VARIABLE has not yet been defined.</p><p>Note that when using <code>@#elseif</code> you can check whether or not a variable has been defined by using the <code>defined</code> operator. Hence, to enter the body of an <code>@#elseif</code> branch if the variable <code>X</code> has not been defined, you would write: <code>@#elseif !defined(X)</code>.</p><p>Note that if a real appears as the result of the MACRO<em>EXPRESSION, it will be interpreted as a boolean; a value of <code>0</code> is interpreted as <code>false</code>, otherwise it is interpreted as <code>true</code>. Further note that because of the imprecision of reals, extra care must be taken when testing them in the MACRO</em>EXPRESSION. For example, <code>exp(log(5)) == 5</code> will evaluate to <code>false</code>. Hence, when comparing real values, you should generally use a zero tolerance around the value desired, e.g. <code>exp(log(5)) &gt; 5-1e-14 &amp;&amp; exp(log(5)) &lt; 5+1e-14</code></p><p><em>Example</em></p><p>Choose between two alternative monetary policy rules using a macro-variable:</p><pre><code class="nohighlight hljs">     @#define linear_mon_pol = false // 0 would be treated the same
     ...
     model;
     @#if linear_mon_pol
       i = w*i(-1) + (1-w)*i_ss + w2*(pie-piestar);
     @#else
       i = i(-1)^w * i_ss^(1-w) * (pie/piestar)^w2;
     @#endif
     ...
     end;</code></pre><p>This would result in:</p><pre><code class="nohighlight hljs">     ...
     model;
       i = i(-1)^w * i_ss^(1-w) * (pie/piestar)^w2;
     ...
     end;</code></pre><p><em>Example</em></p><p>Choose between two alternative monetary policy rules using a macro-variable. The only difference between this example and the previous one is the use of <code>@#ifdef</code> instead of <code>@#if</code>. Even though <code>linear_mon_pol</code> contains the value <code>false</code> because <code>@#ifdef</code> only checks that the variable has been defined, the linear monetary policy is output:</p><pre><code class="nohighlight hljs">     @#define linear_mon_pol = false // 0 would be treated the same
     ...
     model;
     @#ifdef linear_mon_pol
       i = w*i(-1) + (1-w)*i_ss + w2*(pie-piestar);
     @#else
       i = i(-1)^w * i_ss^(1-w) * (pie/piestar)^w2;
     @#endif
     ...
     end;</code></pre><p>This would result in:</p><pre><code class="nohighlight hljs">     ...
     model;
       i = w*i(-1) + (1-w)*i_ss + w2*(pie-piestar);
     ...
     end;</code></pre><p><em>Macro Directive</em>: <code>@#for MACRO_VARIABLE in MACRO_EXPRESSION</code> </p><p><em>Macro Directive</em>: <code>@#for MACRO_VARIABLE in MACRO_EXPRESSION when MACRO_EXPRESSION</code></p><p><em>Macro Directive</em>: <code>@#for MACRO_TUPLE in MACRO_EXPRESSION</code> </p><p><em>Macro Directive</em>: <code>@#for MACRO_TUPLE in MACRO_EXPRESSION when MACRO\_EXPRESSION</code> </p><p><em>Macro Directive</em>: <code>@#endfor</code></p><p>Loop construction for replicating portions of the <code>.mod</code> file. Note that this construct can enclose variable/parameters declaration, computational tasks, but not a model declaration.</p><p><em>Example</em></p><pre><code class="nohighlight hljs">     model;
     @#for country in [ &quot;home&quot;, &quot;foreign&quot; ]
       GDP_@{country} = A * K_@{country}^a * L_@{country}^(1-a);
     @#endfor
     end;</code></pre><p>The latter is equivalent to:</p><pre><code class="nohighlight hljs">     model;
       GDP_home = A * K_home^a * L_home^(1-a);
       GDP_foreign = A * K_foreign^a * L_foreign^(1-a);
     end;</code></pre><p><em>Example</em></p><pre><code class="nohighlight hljs">     model;
     @#for (i, j) in [&quot;GDP&quot;] * [&quot;home&quot;, &quot;foreign&quot;]
       @{i}_@{j} = A * K_@{j}^a * L_@{j}^(1-a);
     @#endfor
     end;</code></pre><p>The latter is equivalent to:</p><pre><code class="nohighlight hljs">     model;
       GDP_home = A * K_home^a * L_home^(1-a);
       GDP_foreign = A * K_foreign^a * L_foreign^(1-a);
     end;</code></pre><p><em>Example</em></p><pre><code class="nohighlight hljs">     @#define countries = [&quot;US&quot;, &quot;FR&quot;, &quot;JA&quot;]
     @#define nth_co = &quot;US&quot;
     model;
     @#for co in countries when co != nth_co
       (1+i_@{co}) = (1+i_@{nth_co}) * E_@{co}(+1) / E_@{co};
     @#endfor
       E_@{nth_co} = 1;
     end;</code></pre><p>The latter is equivalent to:</p><pre><code class="nohighlight hljs">     model;
       (1+i_FR) = (1+i_US) * E_FR(+1) / E_FR;
       (1+i_JA) = (1+i_US) * E_JA(+1) / E_JA;
       E_US = 1;
     end;</code></pre><p><em>Macro Directive</em>: <code>@#echo MACRO_EXPRESSION</code></p><p>Asks the preprocessor to display some message on standard output. The argument must evaluate to a string.</p><p><em>Macro Directive</em>: <code>@#error MACRO_EXPRESSION</code></p><p>Asks the preprocessor to display some error message on standard output and to abort. The argument must evaluate to a string.</p><p><em>Macro Directive</em>: <code>@#echomacrovars</code></p><p><em>Macro Directive</em>: <code>@#echomacrovars MACRO_VARIABLE_LIST</code></p><p><em>Macro Directive</em>: <code>@#echomacrovars(save) MACRO_VARIABLE_LIST</code></p><p>Asks the preprocessor to display the value of all macro variables up until this point. If the <code>save</code> option is passed, then values of the macro variables are saved to <code>options_.macrovars_line_&lt;&lt;line_numbers&gt;&gt;</code>. If <code>NAME_LIST</code> is passed, only display/save variables and functions with that name.</p><p><em>Example</em></p><pre><code class="nohighlight hljs">     @#define A = 1
     @#define B = 2
     @#define C(x) = x*2
     @#echomacrovars A C D</code></pre><p>The output of the command above is:</p><pre><code class="nohighlight hljs">     Macro Variables:
       A = 1
     Macro Functions:
       C(x) = (x * 2)</code></pre><h3 id="Typical-usages"><a class="docs-heading-anchor" href="#Typical-usages">Typical usages</a><a id="Typical-usages-1"></a><a class="docs-heading-anchor-permalink" href="#Typical-usages" title="Permalink"></a></h3><h4 id="Modularization"><a class="docs-heading-anchor" href="#Modularization">Modularization</a><a id="Modularization-1"></a><a class="docs-heading-anchor-permalink" href="#Modularization" title="Permalink"></a></h4><p>The <code>@#include</code> directive can be used to split <code>.mod</code> files into several modular components.</p><p>Example setup:</p><p><code>modeldesc.mod</code></p><p>Contains variable declarations, model equations, and shocks declarations.</p><p><code>simul.mod</code></p><p>Includes <code>modeldesc.mod</code>, calibrates parameter,s and runs stochastic simulations.</p><p><code>estim.mod</code></p><p>Includes <code>modeldesc.mod</code>, declares priors on parameters, and runs Bayesian estimation.</p><p>Dynare can be called on <code>simul.mod</code> and <code>estim.mod</code> but it makes no sense to run it on <code>modeldesc.mod</code>.</p><p>The main advantage is that you don&#39;t have to copy/paste the whole model (at the beginning) or changes to the model (during development).</p><h4 id="Indexed-sums-of-products"><a class="docs-heading-anchor" href="#Indexed-sums-of-products">Indexed sums of products</a><a id="Indexed-sums-of-products-1"></a><a class="docs-heading-anchor-permalink" href="#Indexed-sums-of-products" title="Permalink"></a></h4><p>The following example shows how to construct a moving average:</p><pre><code class="nohighlight hljs">    @#define window = 2

    var x MA_x;
    ...
    model;
    ...
    MA_x = @{1/(2*window+1)}*(
    @#for i in -window:window
            +x(@{i})
    @#endfor
           );
    ...
    end;</code></pre><p>After macro processing, this is equivalent to:</p><pre><code class="nohighlight hljs">    var x MA_x;
    ...
    model;
    ...
    MA_x = 0.2*(
            +x(-2)
            +x(-1)
            +x(0)
            +x(1)
            +x(2)
           );
    ...
    end;</code></pre><h4 id="Multi-country-models"><a class="docs-heading-anchor" href="#Multi-country-models">Multi-country models</a><a id="Multi-country-models-1"></a><a class="docs-heading-anchor-permalink" href="#Multi-country-models" title="Permalink"></a></h4><p>Here is a skeleton example for a multi-country model:</p><pre><code class="nohighlight hljs">    @#define countries = [ &quot;US&quot;, &quot;EA&quot;, &quot;AS&quot;, &quot;JP&quot;, &quot;RC&quot; ]
    @#define nth_co = &quot;US&quot;

    @#for co in countries
    var Y_@{co} K_@{co} L_@{co} i_@{co} E_@{co} ...;
    parameters a_@{co} ...;
    varexo ...;
    @#endfor

    model;
    @#for co in countries
     Y_@{co} = K_@{co}^a_@{co} * L_@{co}^(1-a_@{co});
    ...
    @#if co != nth_co
     (1+i_@{co}) = (1+i_@{nth_co}) * E_@{co}(+1) / E_@{co}; // UIP relation
    @#else
     E_@{co} = 1;
    @#endif
    @#endfor
    end;</code></pre><h4 id="Endogeneizing-parameters"><a class="docs-heading-anchor" href="#Endogeneizing-parameters">Endogeneizing parameters</a><a id="Endogeneizing-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Endogeneizing-parameters" title="Permalink"></a></h4><p>When calibrating the model, it may be useful to consider a parameter as an endogenous variable (and vice-versa).</p><p>For example, suppose production is defined by a CES function:</p><p class="math-container">\[y = \left(\alpha^{1/\xi} \ell^{1-1/\xi}+(1-\alpha)^{1/\xi}k^{1-1/\xi}\right)^{\xi/(\xi-1)}\]</p><p>and the labor share in GDP is defined as:</p><p class="math-container">\[\textrm{lab\_rat} = (w \ell)/(p y)\]</p><p>In the model, <span>$\alpha$</span> is a (share) parameter and <code>lab_rat</code> is an endogenous variable.</p><p>It is clear that calibrating <span>$\alpha$</span> is not straightforward; on the contrary, we have real world data for <code>lab_rat</code> and it is clear that these two variables are economically linked.</p><p>The solution is to use a method called <em>variable flipping</em>, which consists in changing the way of computing the steady state. During this computation, <span>$\alpha$</span> will be made an endogenous variable and <code>lab_rat</code> will be made a parameter. An economically relevant value will be calibrated for <code>lab_rat</code>, and the solution algorithm will deduce the implied value for <span>$\alpha$</span>.</p><p>An implementation could consist of the following files:</p><p><code>modeqs.mod</code></p><p>This file contains variable declarations and model equations. The code for the declaration of <span>$\alpha$</span> and <code>lab_rat</code> would look like:</p><pre><code class="nohighlight hljs">     @#if steady
       var alpha;
       parameter lab_rat;
     @#else
       parameter alpha;
       var lab_rat;
     @#endif</code></pre><p><code>steady.mod</code></p><p>This file computes the steady state. It begins with:</p><pre><code class="nohighlight hljs">     @#define steady = 1
     @#include &quot;modeqs.mod&quot;</code></pre><p>Then it initializes parameters (including <code>lab_rat</code>, excluding <span>$\alpha$</span>), computes the steady state (using guess values for endogenous, including <span>$\alpha$</span>), then saves values of parameters and endogenous at steady state in a file, using the <code>save_params_and_steady_state</code> command.</p><p><code>simul.mod</code></p><p>This file computes the simulation. It begins with:</p><pre><code class="nohighlight hljs">     @#define steady = 0
     @#include &quot;modeqs.mod&quot;</code></pre><p>Then it loads values of parameters and endogenous at steady state from file, using the <code>load_params_and_steady_state</code> command, and computes the simulations.</p><h3 id="Julia-loops-versus-macro-processor-loops"><a class="docs-heading-anchor" href="#Julia-loops-versus-macro-processor-loops">Julia loops versus macro processor loops</a><a id="Julia-loops-versus-macro-processor-loops-1"></a><a class="docs-heading-anchor-permalink" href="#Julia-loops-versus-macro-processor-loops" title="Permalink"></a></h3><p>Suppose you have a model with a parameter <span>$\rho$</span> and you want to run simulations for three values: <span>$\rho = 0.8, 0.9, 1$</span>. There are several ways of doing this:</p><p><em>With a Julia loop</em></p><pre><code class="nohighlight hljs">     rhos = [ 0.8, 0.9, 1];
     for i = 1:length(rhos)
       rho = rhos(i);
       stoch_simul(order=1);
     end</code></pre><p>Here the loop is not unrolled, Julia manages the iterations. This is interesting when there are a lot of iterations.</p><p><em>With a macro processor loop (case 1)</em></p><pre><code class="nohighlight hljs">     rhos = [ 0.8, 0.9, 1];
     @#for i in 1:3
       rho = rhos(@{i});
       stoch_simul(order=1);
     @#endfor</code></pre><p>This is very similar to the previous example, except that the loop is unrolled. The macro processor manages the loop index but not the data array (<code>rhos</code>).</p><p><em>With a macro processor loop (case 2)</em></p><pre><code class="nohighlight hljs">     @#for rho_val in [ 0.8, 0.9, 1]
       rho = @{rho_val};
       stoch_simul(order=1);
     @#endfor</code></pre><p>The advantage of this method is that it uses a shorter syntax, since the list of values is directly given in the loop construct. The inconvenience is that you can not reuse the macro array in Julia.</p><h2 id="Verbatim-inclusion"><a class="docs-heading-anchor" href="#Verbatim-inclusion">Verbatim inclusion</a><a id="Verbatim-inclusion-1"></a><a class="docs-heading-anchor-permalink" href="#Verbatim-inclusion" title="Permalink"></a></h2><p>Pass everything contained within the verbatim block to the <code>&lt;mod_file&gt;.m</code> file.</p><p><em>Block</em>: <code>verbatim ;</code></p><p>By default, whenever Dynare encounters code that is not understood by the parser, it is directly passed to the preprocessor output.</p><p>In order to force this behavior you can use the <code>verbatim</code> block. This is useful when the code you want passed to the <code>&lt;mod_file&gt;.m</code> file contains tokens recognized by the Dynare preprocessor.</p><p><em>Example</em></p><pre><code class="nohighlight hljs">     verbatim;
     % Anything contained in this block will be passed
     % directly to the &lt;modfile&gt;.m file, including comments
     var = 1;
     end;</code></pre><h2 id="Misc-commands"><a class="docs-heading-anchor" href="#Misc-commands">Misc commands</a><a id="Misc-commands-1"></a><a class="docs-heading-anchor-permalink" href="#Misc-commands" title="Permalink"></a></h2><p><em>Command</em>: `save<em>params</em>and<em>steady</em>state (FILENAME);    </p><p>For all parameters, endogenous and exogenous variables, stores their value in a text file, using a simple name/value associative table.</p><ul><li>for parameters, the value is taken from the last parameter   initialization.</li><li>for exogenous, the value is taken from the last <code>initval</code> block.</li><li>for endogenous, the value is taken from the last steady state   computation (or, if no steady state has been computed, from the   last <code>initval</code> block).</li></ul><p>Note that no variable type is stored in the file, so that the values can be reloaded with <code>load_params_and_steady_state</code> in a setup where the variable types are different.</p><p>The typical usage of this function is to compute the steady-state of a model by calibrating the steady-state value of some endogenous variables (which implies that some parameters must be endogeneized during the steady-state computation).</p><p>You would then write a first <code>.mod</code> file which computes the steady state and saves the result of the computation at the end of the file, using <code>save_params_and_steady_state</code>.</p><p>In a second file designed to perform the actual simulations, you would use <code>load_params_and_steady_state</code> just after your variable declarations, in order to load the steady state previously computed (including the parameters which had been endogeneized during the steady state computation).</p><p>The need for two separate <code>.mod</code> files arises from the fact that the variable declarations differ between the files for steady state calibration and for simulation (the set of endogenous and parameters differ between the two); this leads to different <code>var</code> and <code>parameters</code> statements.</p><p>Also note that you can take advantage of the <code>@#include</code> directive to share the model equations between the two files (see <code>macro-proc-lang</code>).</p><ul><li><code>load_params_and_steady_state (FILENAME);</code></li></ul><p>For all parameters, endogenous and exogenous variables, loads their value from a file created with <code>save_params_and_steady_state</code>.</p><ul><li>for parameters, their value will be initialized as if they had   been calibrated in the <code>.mod</code> file.</li><li>for endogenous and exogenous variables, their value will be   initialized as they would have been from an <code>initval</code> block .</li></ul><p>This function is used in conjunction with <code>save_params_and_steady_state</code>; see the documentation of that function for more information.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../model-file/reporting/">« Reporting</a><a class="docs-footer-nextpage" href="../references/">References »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.13.0 on <span class="colophon-date" title="Friday 27 June 2025 15:47">Friday 27 June 2025</span>. Using Julia version 1.10.9.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
